================================================================================
                    ESTRUCTURA DE ROUTING - English27
                           Next.js App Router
================================================================================

FECHA: 2024
ESTADO: âœ… Implementado correctamente

================================================================================
                            ARQUITECTURA DE ROUTING
================================================================================

El proyecto usa Next.js App Router con rutas basadas en carpetas:

app/
â”œâ”€â”€ page.tsx                              â†’ / (Landing)
â”œâ”€â”€ login/
â”‚   â””â”€â”€ page.tsx                          â†’ /login
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ estudiante/
â”‚   â”‚   â””â”€â”€ page.tsx                      â†’ /dashboard/estudiante
â”‚   â”œâ”€â”€ docente/
â”‚   â”‚   â””â”€â”€ page.tsx                      â†’ /dashboard/docente
â”‚   â””â”€â”€ administrador/
â”‚       â””â”€â”€ page.tsx                      â†’ /dashboard/administrador
â”œâ”€â”€ cuenta-pendiente/
â”‚   â””â”€â”€ page.tsx                          â†’ /cuenta-pendiente
â”œâ”€â”€ cuenta-deshabilitada/
â”‚   â””â”€â”€ page.tsx                          â†’ /cuenta-deshabilitada
â”œâ”€â”€ reset-password/
â”‚   â””â”€â”€ page.tsx                          â†’ /reset-password
â””â”€â”€ layout.tsx                            â†’ Layout global


================================================================================
                            PROTECCIÃ“N DE RUTAS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MIDDLEWARE (middleware.ts)                       â”‚
â”‚                                                                         â”‚
â”‚  - Intercepta todas las peticiones                                     â”‚
â”‚  - Verifica sesiÃ³n de Supabase                                         â”‚
â”‚  - Redirige automÃ¡ticamente segÃºn estado                               â”‚
â”‚                                                                         â”‚
â”‚  Rutas pÃºblicas:                                                       â”‚
â”‚    âœ“ /                                                                 â”‚
â”‚    âœ“ /login                                                            â”‚
â”‚    âœ“ /reset-password                                                   â”‚
â”‚                                                                         â”‚
â”‚  Rutas protegidas:                                                     â”‚
â”‚    ğŸ”’ /dashboard/*                                                      â”‚
â”‚    ğŸ”’ /cuenta-*                                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROTECCIÃ“N A NIVEL DE PÃGINA                        â”‚
â”‚                                                                         â”‚
â”‚  Cada pÃ¡gina protegida tiene useEffect que verifica:                   â”‚
â”‚    1. Usuario autenticado                                              â”‚
â”‚    2. Estado de cuenta (activo/pendiente/inactivo)                     â”‚
â”‚    3. Rol correcto para la pÃ¡gina                                      â”‚
â”‚                                                                         â”‚
â”‚  Si no cumple â†’ Redirige a la ruta correcta                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                        FLUJO DE NAVEGACIÃ“N COMPLETO
================================================================================


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                            USUARIO NO AUTENTICADO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Usuario visita cualquier URL
   â””â”€> Middleware verifica sesiÃ³n

2. Si no hay sesiÃ³n y es ruta protegida:
   â””â”€> Redirige a /login

3. Usuario ve pÃ¡gina de login
   â””â”€> Puede iniciar sesiÃ³n o registrarse

4. Al hacer login exitoso:
   â””â”€> AuthContext.signIn() se ejecuta
   â””â”€> Redirige a / (home)

5. page.tsx (home) detecta usuario autenticado:
   â””â”€> Verifica estado_cuenta
   â””â”€> Redirige segÃºn rol:
       â€¢ estudiante â†’ /dashboard/estudiante
       â€¢ docente â†’ /dashboard/docente
       â€¢ administrador â†’ /dashboard/administrador


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                            USUARIO AUTENTICADO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Usuario ya tiene sesiÃ³n activa

2. Visita / (home):
   â””â”€> page.tsx detecta sesiÃ³n
   â””â”€> Redirige automÃ¡ticamente a su dashboard

3. Visita /login:
   â””â”€> Middleware detecta sesiÃ³n
   â””â”€> Redirige a / (que redirige a dashboard)

4. Visita /dashboard/estudiante:
   â””â”€> Middleware permite acceso (ruta protegida con sesiÃ³n)
   â””â”€> PÃ¡gina verifica rol
   â””â”€> Si rol correcto: muestra dashboard
   â””â”€> Si rol incorrecto: redirige a /dashboard/{rol_correcto}

5. Hace logout:
   â””â”€> AuthContext.signOut() se ejecuta
   â””â”€> Limpia sesiÃ³n
   â””â”€> Redirige a /


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                        ESTADOS DE CUENTA ESPECIALES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CUENTA PENDIENTE:
1. Usuario se registra
2. estado_cuenta = 'pendiente'
3. Al hacer login:
   â””â”€> page.tsx detecta estado
   â””â”€> Redirige a /cuenta-pendiente
4. Usuario ve mensaje de espera
5. Cuando admin aprueba:
   â””â”€> estado_cuenta = 'activo'
   â””â”€> PrÃ³ximo login redirige a dashboard

CUENTA DESHABILITADA:
1. Admin desactiva cuenta
2. estado_cuenta = 'inactivo'
3. Al hacer login:
   â””â”€> page.tsx detecta estado
   â””â”€> Redirige a /cuenta-deshabilitada
4. Usuario ve mensaje de cuenta deshabilitada


================================================================================
                            NAVEGACIÃ“N PROGRAMÃTICA
================================================================================

Todos los componentes usan useRouter de Next.js:

import { useRouter } from 'next/navigation'

const router = useRouter()

// Navegar a otra pÃ¡gina
router.push('/dashboard/estudiante')

// Reemplazar en historial (no permite volver atrÃ¡s)
router.replace('/login')

// Volver atrÃ¡s
router.back()

// Refrescar pÃ¡gina actual
router.refresh()


================================================================================
                            VENTAJAS DE ESTA ARQUITECTURA
================================================================================

âœ… URLs funcionales y compartibles
   â†’ localhost:3000/dashboard/estudiante

âœ… Historial del navegador funciona
   â†’ BotÃ³n atrÃ¡s/adelante del navegador

âœ… SEO mejorado
   â†’ Cada pÃ¡gina tiene su propia URL

âœ… CÃ³digo organizado
   â†’ Cada ruta en su propio archivo

âœ… ProtecciÃ³n automÃ¡tica
   â†’ Middleware + verificaciÃ³n en pÃ¡gina

âœ… Redirecciones inteligentes
   â†’ SegÃºn rol y estado de cuenta

âœ… Experiencia de usuario fluida
   â†’ No hay renderizado condicional masivo

âœ… Mantenimiento fÃ¡cil
   â†’ Agregar nueva ruta = crear carpeta + page.tsx


================================================================================
                            COMPARACIÃ“N: ANTES vs AHORA
================================================================================

ANTES (âŒ Anti-patrÃ³n):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app/page.tsx                                                           â”‚
â”‚    â””â”€> if (!user) return <Landing />                                   â”‚
â”‚    â””â”€> if (showLogin) return <Login />                                 â”‚
â”‚    â””â”€> if (rol === 'estudiante') return <EstudianteDashboard />        â”‚
â”‚    â””â”€> if (rol === 'docente') return <DocenteDashboard />              â”‚
â”‚    â””â”€> if (rol === 'admin') return <AdministradorDashboard />          â”‚
â”‚                                                                         â”‚
â”‚  âŒ Todo en un solo archivo                                             â”‚
â”‚  âŒ URL siempre es localhost:3000/                                      â”‚
â”‚  âŒ No hay historial de navegaciÃ³n                                      â”‚
â”‚  âŒ DifÃ­cil de mantener                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


AHORA (âœ… PatrÃ³n correcto):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app/                                                                   â”‚
â”‚    â”œâ”€â”€ page.tsx              â†’ localhost:3000/                         â”‚
â”‚    â”œâ”€â”€ login/page.tsx        â†’ localhost:3000/login                    â”‚
â”‚    â””â”€â”€ dashboard/                                                      â”‚
â”‚        â”œâ”€â”€ estudiante/       â†’ localhost:3000/dashboard/estudiante     â”‚
â”‚        â”œâ”€â”€ docente/          â†’ localhost:3000/dashboard/docente        â”‚
â”‚        â””â”€â”€ administrador/    â†’ localhost:3000/dashboard/administrador  â”‚
â”‚                                                                         â”‚
â”‚  âœ… Cada ruta en su archivo                                             â”‚
â”‚  âœ… URLs funcionales                                                    â”‚
â”‚  âœ… Historial del navegador                                             â”‚
â”‚  âœ… FÃ¡cil de mantener                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                            CÃ“MO AGREGAR NUEVA RUTA
================================================================================

Ejemplo: Agregar pÃ¡gina de perfil

1. Crear carpeta y archivo:
   app/perfil/page.tsx

2. Crear componente:
   'use client'
   
   import { useAuth } from '@/contexts/AuthContext'
   import { useRouter } from 'next/navigation'
   
   export default function PerfilPage() {
     const { user, usuario } = useAuth()
     const router = useRouter()
     
     if (!user) {
       router.push('/login')
       return null
     }
     
     return <div>Perfil de {usuario?.nombre}</div>
   }

3. Navegar desde otro componente:
   router.push('/perfil')

4. Â¡Listo! La ruta estÃ¡ disponible en localhost:3000/perfil


================================================================================
                            RESUMEN TÃ‰CNICO
================================================================================

Framework: Next.js 15 App Router
Routing: File-system based routing
ProtecciÃ³n: Middleware + Client-side verification
NavegaciÃ³n: useRouter hook
Estado: AuthContext (React Context)
AutenticaciÃ³n: Supabase Auth + SSR
Redirecciones: AutomÃ¡ticas segÃºn rol y estado

================================================================================
